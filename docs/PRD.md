# 📦 MyDHL API 고객사 내부 시스템 개발 가이드 (PRD)

## 1. 프로젝트 목표 🚀
MyDHL API와 Gemini 3 Flash Preview를 결합하여 운송장 생성, 조회, 픽업 요청을 처리하는 직관적인 물류 관리 시스템 구축

## 2. 핵심 기능 및 로직 ✨

### ① 운송장 관리 (CRUD & Dashboard)

- **명세 준수**: `docs/mydhl-api-2.9.0-swagger.yaml` 및 `Reference data guide (3.1.2)`의 필수 필드를 최우선으로 반영
- **대시보드**: 메인 화면에 실시간 배송 상태(작성 중, 운송장 생성 완료, 픽업 완료, 배송 완료)를 요약하여 표시
- **필터 및 정렬**: 도착지 국가, 상태별 필터링 및 생성일 순 정렬 기능 구현

### ② 지능형 AI 기능 (Gemini 3 Flash Preview 활용)

- **AI HS 코드 추천**: 
  - 물품명을 기반으로 가장 적합한 **6~10자리 HS 코드** 추천 (HS 코드는 도착 국가 기준의 수입 코드 기준으로 추천)
  - 수취 국가 기준으로 추천되었다고 명시시하고 추천 사유를 함께 제시
  - 사용자가 '확인' 버튼을 누를 때만 입력 폼에 최종 반영하고 수정도 가능하게 조치

## 3. 화면 구성 및 사용자 흐름 🖼️

- **인증(Auth)**: Supabase Auth를 사용하며, 관리자가 승인한 계정만 운송장 생성 및 픽업 요청 가능
  승인 받지 못한 사용자에게도 승인 받은 사용자와 동일한 화면을 보여주지만, 운송장 생성 및 픽업 요청 과정의 최종 마지막 단계에서 '완료' 버튼 비활성화
  운송장 생성 페이지와 픽업 요청 페이지 최상단에 "승인 받은 사용자만 운송장 생성 및 픽업 요청이 가능합니다." 문구 표시
  Supabase에 별도 승인 필드 추가
- **로그인/회원가입**: 사용자 인증 및 계정 관리 (고객번호 도용 방지를 위해 관리자 인증 후 사용 가능)
- **메인 화면**: 전체 배송 현황 대시보드 및 주요 메뉴(견적, 생성, 조회, 픽업) 바로가기 버튼
- **견적 조회 및 발송 가능 확인**: 목적지별 견적 산출 및 발송 가능 지역 여부 체크
- **운송장 생성 페이지**: 필수 필드 입력 폼 및 AI 입력 기능 제공
- **운송장 조회 페이지**: 기존 생성된 운송장의 상세 정보 및 히스토리 확인
- **픽업 요청 페이지**: 별도의 픽업 예약만을 위한 전용 화면

## 4. 데이터베이스 구조

- **Users 테이블**: 사용자 계정 및 승인 상태 관리.
- **Shipments 테이블**: 운송장 및 픽업 정보 관리 (User ID와 Foreign Key 연결).

## 5. 개발 원칙

- 모든 API 응답 데이터는 **Zod**를 사용하여 런타임 검증 수행
- 사용자에게는 에러 코드 대신 친절한 **한글 메시지** 제공
- 모든 함수와 컴포넌트 상단에는 한 줄의 **한글 개요** 작성

## 6. 운송장 생성 프로세스

- process
1) 사용자가 운송장 데이터 입력
2) MyDHL API 스펙 JSON으로 변환
3) Next.js 서버에서 fetch로 MyDHL API 테스트 서버로 전송
4) 응답(AWB/라벨 등)

- detailed process
1) 사용자가 /shipments/create에서 입력
2) createShipment()로 DB(Supabase)에 draft 저장
3) 상세(/shipments/[id])에서 “라벨 생성” 버튼 클릭
4) 서버 액션 createDhlLabel(shipmentId) 실행
5) DB에서 shipment/lineItems/package 다시 읽기(권한 체크)
6) DB → MyDHL 요청 JSON 변환(mapper)
7) 서버에서 fetch로 MyDHL API 호출
8) 응답에서 AWB/라벨 추출 → DB 업데이트(status 전환)
9) UI에 결과 표시

- 참고사항 및 주의사항
1) `docs/mydhl-api-2.9.0-swagger copy.yaml`, `/docs/MyDHL API Reference data guide (3.1.2).pdf` 규칙을 바탕으로 개발
2) MyDHL API는 Basic Auth를 통해 인증.
3) .env.local에 정리되어 있는 테스트 서버 URL로 전송